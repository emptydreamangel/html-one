<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List Application with Laf Cloud Functions</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            padding-bottom: 50px;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: hidden;
            background-color: #f5f5f5;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .code-block {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .code-caption {
            font-style: italic;
            margin-top: 5px;
            color: #666;
        }
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background-color: #007bff;
            color: white;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }
        .section-divider {
            height: 2px;
            background-color: #e0e0e0;
            margin: 40px 0;
        }
    </style>
</head>
<body class="mx-auto px-4 py-8 max-w-4xl">
    <header class="text-center mb-10">
        <h1 class="text-4xl font-bold text-blue-700 mb-4">Building a Todo List with Laf Cloud Functions</h1>
        <p class="text-lg text-gray-600">A full-stack application tutorial showcasing frontend and backend integration</p>
    </header>

    <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Introduction to Laf</h2>
        <p class="mb-4">
            Laf is an open-source cloud development platform that provides cloud functions, cloud databases, and cloud storage solutions. 
            It enables frontend developers to become full-stack developers by using JavaScript/TypeScript for both frontend and backend development.
        </p>
        <p class="mb-4">
            In this tutorial, we'll build a simple Todo List application using Laf's cloud functions and database capabilities. The application will allow users to:
        </p>
        <ul class="list-disc pl-6 mb-4">
            <li>Add new todo items</li>
            <li>Mark todos as completed</li>
            <li>Delete todo items</li>
            <li>View all todos with their status</li>
        </ul>
    </section>

    <div class="section-divider"></div>

    <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Setting Up Your Laf Project</h2>
        
        <div class="mb-6">
            <h3 class="text-xl font-semibold mb-2 flex items-center">
                <span class="step-number">1</span> Create a Laf Account
            </h3>
            <p class="mb-4">
                Visit <a href="https://laf.dev" class="text-blue-500 underline">laf.dev</a> (or <a href="https://laf.run" class="text-blue-500 underline">laf.run</a> for the Chinese version) and create an account.
            </p>
        </div>

        <div class="mb-6">
            <h3 class="text-xl font-semibold mb-2 flex items-center">
                <span class="step-number">2</span> Create a New Application
            </h3>
            <p class="mb-4">
                After logging in, create a new application from the dashboard and give it a name like "todo-list-app".
            </p>
        </div>

        <div class="mb-6">
            <h3 class="text-xl font-semibold mb-2 flex items-center">
                <span class="step-number">3</span> Set Up the Database Collection
            </h3>
            <p class="mb-4">
                Navigate to the Database section in your Laf application dashboard and create a new collection named "todos".
            </p>
            <div class="code-block">
                <pre>
// Collection name: todos
// Schema structure:
{
  "_id": "ObjectId", // Auto-generated by MongoDB
  "title": "String",  // The todo title
  "completed": "Boolean", // Whether the todo is completed
  "createdAt": "Date" // When the todo was created
}
                </pre>
                <div class="code-caption">Todos collection schema</div>
            </div>
        </div>
    </section>

    <div class="section-divider"></div>

    <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Backend: Creating Cloud Functions</h2>
        <p class="mb-4">
            We'll create four cloud functions to handle CRUD operations for our todo items. Navigate to the Functions section in your Laf application dashboard to create these.
        </p>

        <div class="mb-8">
            <h3 class="text-xl font-semibold mb-2">1. Get All Todos</h3>
            <p class="mb-4">Create a new function named "getTodos" with the following code:</p>
            <div class="code-block">
                <pre>
import cloud from '@lafjs/cloud'

export async function main(ctx: FunctionContext) {
  const db = cloud.database()
  const todosCollection = db.collection('todos')
  
  try {
    // Get all todos sorted by creation time (newest first)
    const todos = await todosCollection
      .find()
      .sort({ createdAt: -1 })
      .toArray()
    
    return {
      success: true,
      data: todos
    }
  } catch (error) {
    return {
      success: false,
      error: error.message
    }
  }
}
                </pre>
                <div class="code-caption">Cloud function to retrieve all todos</div>
            </div>
        </div>

        <div class="mb-8">
            <h3 class="text-xl font-semibold mb-2">2. Create a New Todo</h3>
            <p class="mb-4">Create a new function named "createTodo" with the following code:</p>
            <div class="code-block">
                <pre>
import cloud from '@lafjs/cloud'

export async function main(ctx: FunctionContext) {
  const db = cloud.database()
  const todosCollection = db.collection('todos')
  
  // Get the todo title from the request
  const { title } = ctx.body
  
  if (!title || typeof title !== 'string' || title.trim() === '') {
    return {
      success: false,
      error: 'Todo title is required'
    }
  }
  
  try {
    // Create a new todo object
    const todo = {
      title: title.trim(),
      completed: false,
      createdAt: new Date()
    }
    
    // Insert the todo into the database
    const result = await todosCollection.insertOne(todo)
    
    return {
      success: true,
      data: {
        ...todo,
        _id: result.insertedId
      }
    }
  } catch (error) {
    return {
      success: false,
      error: error.message
    }
  }
}
                </pre>
                <div class="code-caption">Cloud function to create a new todo</div>
            </div>
        </div>

        <div class="mb-8">
            <h3 class="text-xl font-semibold mb-2">3. Update Todo Status</h3>
            <p class="mb-4">Create a new function named "updateTodoStatus" with the following code:</p>
            <div class="code-block">
                <pre>
import cloud from '@lafjs/cloud'
import { ObjectId } from 'mongodb'

export async function main(ctx: FunctionContext) {
  const db = cloud.database()
  const todosCollection = db.collection('todos')
  
  // Get the todo ID and completed status from the request
  const { id, completed } = ctx.body
  
  if (!id) {
    return {
      success: false,
      error: 'Todo ID is required'
    }
  }
  
  if (typeof completed !== 'boolean') {
    return {
      success: false,
      error: 'Completed status must be a boolean'
    }
  }
  
  try {
    // Update the todo's completed status
    const result = await todosCollection.updateOne(
      { _id: new ObjectId(id) },
      { $set: { completed } }
    )
    
    if (result.matchedCount === 0) {
      return {
        success: false,
        error: 'Todo not found'
      }
    }
    
    return {
      success: true,
      data: { id, completed }
    }
  } catch (error) {
    return {
      success: false,
      error: error.message
    }
  }
}
                </pre>
                <div class="code-caption">Cloud function to update a todo's status</div>
            </div>
        </div>

        <div class="mb-8">
            <h3 class="text-xl font-semibold mb-2">4. Delete a Todo</h3>
            <p class="mb-4">Create a new function named "deleteTodo" with the following code:</p>
            <div class="code-block">
                <pre>
import cloud from '@lafjs/cloud'
import { ObjectId } from 'mongodb'

export async function main(ctx: FunctionContext) {
  const db = cloud.database()
  const todosCollection = db.collection('todos')
  
  // Get the todo ID from the request
  const { id } = ctx.body
  
  if (!id) {
    return {
      success: false,
      error: 'Todo ID is required'
    }
  }
  
  try {
    // Delete the todo
    const result = await todosCollection.deleteOne({ _id: new ObjectId(id) })
    
    if (result.deletedCount === 0) {
      return {
        success: false,
        error: 'Todo not found'
      }
    }
    
    return {
      success: true,
      data: { id }
    }
  } catch (error) {
    return {
      success: false,
      error: error.message
    }
  }
}
                </pre>
                <div class="code-caption">Cloud function to delete a todo</div>
            </div>
        </div>
    </section>

    <div class="section-divider"></div>

    <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Frontend: Creating the Todo List Interface</h2>
        <p class="mb-4">
            Now let's create a simple frontend interface for our Todo List application. We'll use HTML, CSS (with Tailwind), and JavaScript.
        </p>
        <p class="mb-4">
            In Laf, you can host static websites directly. Navigate to the "Website Hosting" section in your Laf application dashboard and create a new website.
        </p>

        <div class="mb-8">
            <h3 class="text-xl font-semibold mb-2">1. HTML Structure</h3>
            <p class="mb-4">Create an <code>index.html</code> file with the following content:</p>
            <div class="code-block">
                <pre>
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Todo List with Laf&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body class="bg-gray-100 min-h-screen flex flex-col items-center pt-10"&gt;
    &lt;div class="container max-w-md bg-white rounded-lg shadow-lg p-6"&gt;
        &lt;h1 class="text-3xl font-bold text-center text-blue-600 mb-6"&gt;Todo List&lt;/h1&gt;
        
        &lt;div class="mb-6"&gt;
            &lt;form id="todo-form" class="flex"&gt;
                &lt;input 
                    type="text" 
                    id="todo-input" 
                    placeholder="Add a new task..." 
                    class="flex-1 border border-gray-300 rounded-l-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    required
                &gt;
                &lt;button 
                    type="submit" 
                    class="bg-blue-500 hover:bg-blue-600 text-white rounded-r-lg px-4 transition duration-200"
                &gt;
                    Add
                &lt;/button&gt;
            &lt;/form&gt;
        &lt;/div&gt;
        
        &lt;div id="todos-container"&gt;
            &lt;div class="flex justify-between items-center mb-4"&gt;
                &lt;h2 class="text-xl font-semibold"&gt;My Tasks&lt;/h2&gt;
                &lt;span id="todo-count" class="bg-blue-100 text-blue-800 font-semibold px-3 py-1 rounded-full"&gt;0&lt;/span&gt;
            &lt;/div&gt;
            
            &lt;ul id="todo-list" class="space-y-2"&gt;
                &lt;!-- Todo items will be dynamically added here --&gt;
                &lt;li class="animate-pulse flex items-center justify-center p-4 bg-gray-100 rounded-lg"&gt;
                    Loading todos...
                &lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;script src="app.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
                </pre>
                <div class="code-caption">HTML structure for the Todo List interface</div>
            </div>
        </div>

        <div class="mb-8">
            <h3 class="text-xl font-semibold mb-2">2. JavaScript (app.js)</h3>
            <p class="mb-4">Create an <code>app.js</code> file with the following content:</p>
            <div class="code-block">
                <pre>
// Replace these values with your actual Laf application details
const LAF_APP_ID = 'YOUR_LAF_APP_ID';
const LAF_API_URL = `https://${LAF_APP_ID}.laf.dev`;

// DOM Elements
const todoForm = document.getElementById('todo-form');
const todoInput = document.getElementById('todo-input');
const todoList = document.getElementById('todo-list');
const todoCount = document.getElementById('todo-count');

// Initialize the application
document.addEventListener('DOMContentLoaded', () => {
  fetchTodos();
  todoForm.addEventListener('submit', handleAddTodo);
});

// Fetch all todos from the server
async function fetchTodos() {
  try {
    const response = await fetch(`${LAF_API_URL}/getTodos`);
    const result = await response.json();
    
    if (result.success) {
      renderTodos(result.data);
    } else {
      showError('Failed to load todos: ' + result.error);
    }
  } catch (error) {
    showError('Error connecting to the server');
    console.error(error);
  }
}

// Render the list of todos
function renderTodos(todos) {
  // Clear the loading message
  todoList.innerHTML = '';
  
  // Update the todo count
  todoCount.textContent = todos.length;
  
  if (todos.length === 0) {
    todoList.innerHTML = `
      <li class="flex items-center justify-center p-4 text-gray-500 bg-gray-50 rounded-lg">
        No tasks yet. Add one above!
      </li>
    `;
    return;
  }
  
  // Add each todo to the list
  todos.forEach(todo => {
    const todoItem = document.createElement('li');
    todoItem.className = `flex items-center justify-between p-3 bg-gray-50 rounded-lg transition duration-200 ${todo.completed ? 'bg-green-50' : ''}`;
    todoItem.innerHTML = `
      <div class="flex items-center">
        <input 
          type="checkbox" 
          class="w-5 h-5 mr-3 cursor-pointer" 
          ${todo.completed ? 'checked' : ''}
          onchange="handleToggleTodo('${todo._id}', this.checked)"
        >
        <span class="${todo.completed ? 'line-through text-gray-500' : 'text-gray-800'}">${escapeHtml(todo.title)}</span>
      </div>
      <button 
        onclick="handleDeleteTodo('${todo._id}')" 
        class="text-red-500 hover:text-red-700 transition duration-200"
      >
        <i class="fas fa-trash-alt"></i>
      </button>
    `;
    todoList.appendChild(todoItem);
  });
}

// Handle adding a new todo
async function handleAddTodo(event) {
  event.preventDefault();
  
  const title = todoInput.value.trim();
  if (!title) return;
  
  try {
    const response = await fetch(`${LAF_API_URL}/createTodo`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ title })
    });
    
    const result = await response.json();
    
    if (result.success) {
      todoInput.value = '';
      fetchTodos(); // Refresh the todo list
    } else {
      showError('Failed to add todo: ' + result.error);
    }
  } catch (error) {
    showError('Error connecting to the server');
    console.error(error);
  }
}

// Handle toggling a todo's completed status
async function handleToggleTodo(id, completed) {
  try {
    const response = await fetch(`${LAF_API_URL}/updateTodoStatus`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ id, completed })
    });
    
    const result = await response.json();
    
    if (result.success) {
      fetchTodos(); // Refresh the todo list
    } else {
      showError('Failed to update todo: ' + result.error);
    }
  } catch (error) {
    showError('Error connecting to the server');
    console.error(error);
  }
}

// Handle deleting a todo
async function handleDeleteTodo(id) {
  if (!confirm('Are you sure you want to delete this task?')) return;
  
  try {
    const response = await fetch(`${LAF_API_URL}/deleteTodo`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ id })
    });
    
    const result = await response.json();
    
    if (result.success) {
      fetchTodos(); // Refresh the todo list
    } else {
      showError('Failed to delete todo: ' + result.error);
    }
  } catch (error) {
    showError('Error connecting to the server');
    console.error(error);
  }
}

// Utility function to show an error message
function showError(message) {
  alert(message);
}

// Utility function to escape HTML special characters
function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}
                </pre>
                <div class="code-caption">JavaScript code for the Todo List functionality</div>
            </div>
        </div>
    </section>

    <div class="section-divider"></div>

    <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Deploying Your Todo List Application</h2>
        
        <div class="mb-6">
            <h3 class="text-xl font-semibold mb-2 flex items-center">
                <span class="step-number">1</span> Configure Cloud Function Permissions
            </h3>
            <p class="mb-4">
                For each of your cloud functions, you need to make them publicly accessible:
            </p>
            <ul class="list-disc pl-6 mb-4">
                <li>Go to each function in the Laf dashboard</li>
                <li>Click on the "Settings" tab</li>
                <li>Enable "Public Function"</li>
                <li>Save the changes</li>
            </ul>
        </div>

        <div class="mb-6">
            <h3 class="text-xl font-semibold mb-2 flex items-center">
                <span class="step-number">2</span> Deploy the Frontend
            </h3>
            <p class="mb-4">
                Upload your frontend files to the Website Hosting section:
            </p>
            <ul class="list-disc pl-6 mb-4">
                <li>Go to "Website Hosting" in the Laf dashboard</li>
                <li>Upload your <code>index.html</code> and <code>app.js</code> files</li>
                <li>Update the <code>LAF_APP_ID</code> in your <code>app.js</code> file with your actual Laf application ID</li>
            </ul>
        </div>

        <div class="mb-6">
            <h3 class="text-xl font-semibold mb-2 flex items-center">
                <span class="step-number">3</span> Test Your Application
            </h3>
            <p class="mb-4">
                Your Todo List application should now be fully functional:
            </p>
            <ul class="list-disc pl-6 mb-4">
                <li>Visit your website URL (provided in the Website Hosting section)</li>
                <li>Add new todos, mark them as completed, and delete them</li>
                <li>Verify that all operations are working correctly</li>
            </ul>
        </div>
    </section>

    <div class="section-divider"></div>

    <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Understanding the Integration</h2>
        
        <p class="mb-4">
            Let's understand how the frontend and backend are integrated in this application:
        </p>

        <div class="bg-blue-50 p-6 rounded-lg mb-6">
            <h3 class="text-xl font-semibold mb-3 text-blue-700">Frontend-Backend Communication</h3>
            <p class="mb-2">
                The frontend JavaScript code makes HTTP requests to the cloud functions we created:
            </p>
            <ul class="list-disc pl-6 mb-4">
                <li><strong>GET Todos</strong>: Fetches all todos when the page loads</li>
                <li><strong>Create Todo</strong>: Sends a new todo to the server when the form is submitted</li>
                <li><strong>Update Todo Status</strong>: Toggles a todo's completion status when the checkbox is clicked</li>
                <li><strong>Delete Todo</strong>: Removes a todo when the delete button is clicked</li>
            </ul>
            <p>
                All of these operations interact with the MongoDB database we set up through the Laf cloud functions.
            </p>
        </div>

        <div class="bg-green-50 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-green-700">Benefits of Using Laf</h3>
            <p class="mb-2">
                This approach has several advantages:
            </p>
            <ul class="list-disc pl-6">
                <li><strong>Simplified Development</strong>: No need to manage servers or databases directly</li>
                <li><strong>Consistent Language</strong>: Using JavaScript/TypeScript for both frontend and backend</li>
                <li><strong>Easy Deployment</strong>: Built-in hosting for both cloud functions and static website</li>
                <li><strong>Scalability</strong>: Laf handles scaling of your application as needed</li>
                <li><strong>Security</strong>: Laf provides built-in security features and authentication options</li>
            </ul>
        </div>
    </section>

    <div class="section-divider"></div>

    <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Further Enhancements</h2>
        
        <p class="mb-4">
            Once you've completed the basic Todo List application, you can enhance it with these features:
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gray-50 p-5 rounded-lg">
                <h3 class="text-lg font-semibold mb-2">User Authentication</h3>
                <p>Add user registration and login to create personalized todo lists for each user. Laf provides authentication services that you can integrate.</p>
            </div>
            
            <div class="bg-gray-50 p-5 rounded-lg">
                <h3 class="text-lg font-semibold mb-2">Categories or Tags</h3>
                <p>Allow users to categorize their todos or add tags to better organize their tasks.</p>
            </div>
            
            <div class="bg-gray-50 p-5 rounded-lg">
                <h3 class="text-lg font-semibold mb-2">Due Dates</h3>
                <p>Add the ability to set due dates for todos and implement sorting and filtering based on dates.</p>
            </div>
            
            <div class="bg-gray-50 p-5 rounded-lg">
                <h3 class="text-lg font-semibold mb-2">Mobile App Integration</h3>
                <p>Create a mobile app that connects to the same Laf backend, providing a consistent experience across devices.</p>
            </div>
        </div>
    </section>

    <div class="section-divider"></div>

    <section>
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Conclusion</h2>
        
        <p class="mb-4">
            In this tutorial, we've built a simple yet functional Todo List application using Laf's cloud functions and database capabilities. This demonstrates how Laf enables frontend developers to become full-stack developers by providing easy-to-use backend services.
        </p>
        
        <p class="mb-4">
            The key takeaways from this project are:
        </p>
        
        <ul class="list-disc pl-6 mb-6">
            <li>Laf provides a seamless development experience with JavaScript/TypeScript on both frontend and backend</li>
            <li>Cloud functions offer a simple way to implement CRUD operations without managing servers</li>
            <li>MongoDB database integration is straightforward through Laf's database services</li>
            <li>Static website hosting makes deploying frontend applications easy</li>
        </ul>
        
        <p class="text-gray-700 italic">
            For more information and advanced features, visit the official <a href="https://laf.dev" class="text-blue-500 underline">Laf documentation</a>.
        </p>
    </section>
</body>
</html>
